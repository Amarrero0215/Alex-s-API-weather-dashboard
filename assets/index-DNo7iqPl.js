(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();const m=document.getElementById("search-form"),f=document.getElementById("search-input"),h=document.querySelector("#today"),d=document.querySelector("#forecast"),s=document.getElementById("history"),y=document.getElementById("search-title"),u=document.getElementById("weather-img"),g=document.getElementById("temp"),E=document.getElementById("wind"),b=document.getElementById("humidity"),w=async t=>{try{const e=await fetch("/api/weather/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({city:t})});if(!e.ok){const r=await e.json();alert(`Error: ${r.error}`),console.log("Server error:",r.error);return}const n=await e.json();console.log("weatherData: ",n),B(n.currentWeather),H(n.forecast)}catch(e){console.error("Error fetching weather data:",e),alert("Failed to fetch weather data. Please try again!")}},L=async()=>await fetch("/api/weather/history",{method:"GET",headers:{"Content-Type":"application/json"}}),C=async t=>{await fetch(`/api/weather/history/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})},B=t=>{const{city:e,date:n,icon:r,iconDescription:o,tempF:c,windSpeed:a,humidity:i}=t;y.textContent=`${e} (${n})`,u.setAttribute("src",`https://openweathermap.org/img/w/${r}.png`),u.setAttribute("alt",o),u.setAttribute("class","weather-img"),y.append(u),g.textContent=`Temp: ${c}°F`,E.textContent=`Wind: ${a} MPH`,b.textContent=`Humidity: ${i} %`,h&&(h.innerHTML="",h.append(y,g,E,b))},H=t=>{const e=document.createElement("div"),n=document.createElement("h4");e.setAttribute("class","col-12"),n.textContent="5-Day Forecast:",e.append(n),d&&(d.innerHTML="",d.append(e));for(let r=0;r<t.length;r++)A(t[r])},A=t=>{const{date:e,icon:n,iconDescription:r,tempF:o,windSpeed:c,humidity:a}=t,{col:i,cardTitle:I,weatherIcon:p,tempEl:v,windEl:x,humidityEl:S}=F();I.textContent=e,p.setAttribute("src",`https://openweathermap.org/img/w/${n}.png`),p.setAttribute("alt",r),v.textContent=`Temp: ${o} °F`,x.textContent=`Wind: ${c} MPH`,S.textContent=`Humidity: ${a} %`,d&&d.append(i)},T=async t=>{const e=await t.json();if(s){if(s.innerHTML="",!e.length){s.innerHTML='<p class="text-center">No Previous Search History</p>';return}for(let n=e.length-1;n>=0;n--){const r=j(e[n]);s.append(r)}}},D=()=>{if(document.getElementById("clear-history-btn"))return;const t=document.createElement("button");t.setAttribute("id","clear-history-btn"),t.textContent="Clear All History",t.classList.add("btn","btn-danger","m-2"),t.addEventListener("click",async()=>{try{const n=await(await L()).json();for(const r of n)await C(r.id);l(),alert("Search history cleared successfully!")}catch(e){console.error("Failed to clear history:",e),alert("Failed to clear history. Please try again!")}}),s==null||s.append(t)},F=()=>{const t=document.createElement("div"),e=document.createElement("div"),n=document.createElement("div"),r=document.createElement("h5"),o=document.createElement("img"),c=document.createElement("p"),a=document.createElement("p"),i=document.createElement("p");return t.append(e),e.append(n),n.append(r,o,c,a,i),t.classList.add("col-auto"),e.classList.add("forecast-card","card","text-white","bg-primary","h-100"),n.classList.add("card-body","p-2"),r.classList.add("card-title"),c.classList.add("card-text"),a.classList.add("card-text"),i.classList.add("card-text"),{col:t,cardTitle:r,weatherIcon:o,tempEl:c,windEl:a,humidityEl:i}},$=t=>{const e=document.createElement("button");return e.setAttribute("type","button"),e.setAttribute("aria-controls","today forecast"),e.classList.add("history-btn","btn","btn-secondary","col-10"),e.textContent=t,e},P=()=>{const t=document.createElement("button");return t.setAttribute("type","button"),t.classList.add("fas","fa-trash-alt","delete-city","btn","btn-danger","col-2"),t.addEventListener("click",W),t},O=()=>{const t=document.createElement("div");return t.classList.add("display-flex","gap-2","col-12","m-1"),t},j=t=>{const e=$(t.name),n=P();n.dataset.city=JSON.stringify(t);const r=O();return r.append(e,n),r},M=t=>{t.preventDefault();const e=f.value.trim();if(!e){alert("City cannot be blank!");return}console.log("Sending City:",e),w(e).then(()=>{l()}),f.value=""},N=t=>{if(t.target.matches(".history-btn")){const e=t.target.textContent;w(e).then(l)}},W=t=>{t.stopPropagation();const e=JSON.parse(t.target.getAttribute("data-city")).id;C(e).then(l)},l=()=>L().then(T).then(()=>{D()});console.log("Event listener attached to search form");m==null||m.addEventListener("submit",M);s==null||s.addEventListener("click",N);l();
